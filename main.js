(()=>{"use strict";var e=null;function t(t){"Escape"===t.key&&o(e)}function n(n){n.classList.add("popup_is-opened"),document.addEventListener("keydown",t),e=n}function o(n){n.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t),e=null}var r,a="65e854c4-700a-467d-be02-5c38257cf03e",c={baseurl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",token:a,headers:{"Content-Type":"application/json",authorization:a}},i=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},s=document.getElementById("card-template").content;function l(e,t,n){var o=s.querySelector(".card").cloneNode(!0),a=o.querySelector(".card__image");a.src=e.link,a.alt=e.name,o.querySelector(".card__title").textContent=e.name,a.addEventListener("click",(function(){t(a.src,a.alt)}));var l=o.querySelector(".card__delete-button");console.log(e.owner._id,n),e.owner._id!==n?l.style.display="none":l.addEventListener("click",(function(){r=l})),l.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(c.baseurl,"/cards/").concat(t),{method:"DELETE",headers:c.headers}).then(i).catch((function(e){console.log(e)}))).then((function(){r.closest(".places__item").remove()}))}));var d=o.querySelector(".card__like-count"),u=o.querySelector(".card__like-button");return e.likes.some((function(e){return e._id===n}))&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(function(){return function(e,t,n){var o=e.classList.contains("card__like-button_is-active");t&&(o?function(e){return fetch("".concat(c.baseurl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(i).catch((function(e){console.log(e)}))}(t).then((function(t){t&&(e.classList.toggle("card__like-button_is-active"),n.textContent=t.likes.length)})).catch(console.error):function(e){return fetch("".concat(c.baseurl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(i).catch((function(e){console.log(e)}))}(t).then((function(t){t&&(e.classList.toggle("card__like-button_is-active"),n.textContent=t.likes.length)})).catch(console.error))}(u,e._id,d)})),d.textContent=e.likes.length,o}var d=document.forms["edit-profile"],u=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),f=document.getElementById("profileNameError"),p=document.getElementById("profileDescriptionError"),h=d.querySelector(".button"),v={input:d.name,errorElement:f,minLength:2,maxLength:40},g={input:d.description,errorElement:p,minLength:2,maxLength:200},b=function(e){var t=e.input,n=e.errorElement,o=e.minLength,r=e.maxLength,a=t.value.trim();return console.log(a),a.length<o||a.length>r?(n.textContent="Должно быть от ".concat(o," до ").concat(r," символов."),!1):!!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(a)||(n.textContent="Допустимы только латинские и кириллические буквы, пробелы и дефисы.",!1)};function y(){var e=b(v),t=b(g);e&&t?(h.disabled=!1,h.classList.contains("button-disabled")&&h.classList.remove("button-disabled"),f.textContent="",p.textContent=""):(h.disabled=!0,h.classList.contains("button-disabled")||h.classList.add("button-disabled"))}var L=document.forms["new-place"],E=document.getElementById("placeNameDescriptionError"),_=document.getElementById("LinkDescriptionError"),x=L.querySelector(".button"),C={input:L["place-name"],errorElement:E,minLength:2,maxLength:30},k={input:L.link,errorElement:_};function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";"add"===t&&(e.classList.contains("input-error")||e.classList.add("input-error")),"remove"===t&&e.classList.contains("input-error")&&e.classList.remove("input-error")}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add";"add"===e&&(x.disabled=!0,x.classList.contains("button-disabled")||x.classList.add("button-disabled")),"remove"===e&&(x.disabled=!1,x.classList.contains("button-disabled")&&x.classList.remove("button-disabled"))}var I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"remove";E.textContent="",_.textContent="",S(L["place-name"],"remove"),S(L.link,"remove"),q(e)},w=document.forms["change-avatar"],A=document.getElementById("profileImageError"),B=w.querySelector(".button"),j=document.querySelector(".profile__image"),T={input:w.link,errorElement:A};function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";"add"===t&&(e.classList.contains("input-error")||e.classList.add("input-error")),"remove"===t&&e.classList.contains("input-error")&&e.classList.remove("input-error")}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add";"add"===e&&(B.disabled=!0,B.classList.contains("button-disabled")||B.classList.add("button-disabled")),"remove"===e&&(B.disabled=!1,B.classList.contains("button-disabled")&&B.classList.remove("button-disabled"))}function O(){var e,t,n;P((t=(e=T).input,n=e.errorElement,(t.checkValidity()?(n.textContent="",D(t,"remove"),1):(n.textContent="Введите корректный URL.",D(t,"add"),0))?"remove":"add"))}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var U,$=document.querySelector(".places__list"),z=document.querySelector(".popup_type_new-card"),H=document.querySelector(".popup_type_edit"),J=document.querySelector(".popup_type_image"),R=document.getElementById("editProfileButton"),G=document.getElementById("newCardButton"),V=document.getElementById("popupImage"),Z=document.getElementById("popupCaption"),M=document.querySelector(".popup_type_avatar"),F=document.querySelector(".profile__image-container");Promise.all([fetch("".concat(c.baseurl,"/users/me"),{method:"GET",headers:c.headers}).then(i),fetch("".concat(c.baseurl,"/cards"),{method:"GET",headers:c.headers}).then(i).catch((function(e){console.log(e)}))]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,c,i=[],s=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);s=!0);}catch(e){l=!0,r=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],a=o[1];u.textContent=r.name,m.textContent=r.about,j.src=r.avatar,U=r._id,a.forEach((function(e){var t=l(e,Q,U);$.append(t)}))})).catch(console.error),G.addEventListener("click",(function(){I("add"),n(z)})),R.addEventListener("click",(function(){return function(e){e.name.value=u.textContent,e.description.value=m.textContent,n(H)}(d)})),F.addEventListener("click",(function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"remove";A.textContent="",D(w.link,"remove"),P(e)}("add"),n(M)}));var K=document.querySelectorAll(".popup");function Q(e,t){V.src=e,V.alt=t,Z.textContent=t,n(J)}K.forEach((function(e){e.classList.add("popup_is-animated")})),K.forEach((function(e){e.addEventListener("mousedown",(function(t){return function(e,t){e.target.classList.contains("popup_is-opened")&&o(t),e.target.classList.contains("popup__close")&&o(t)}(t,e)}))})),L.addEventListener("input",(function(){var e,t,n,o,r,a,c,i=(t=(e=C).input,n=e.errorElement,o=e.minLength,r=e.maxLength,a=t.value.trim(),c=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/,console.log(a,c.test(a)),a.length<o||a.length>r?(n.textContent="Название должно содержать от ".concat(o," до ").concat(r," символов."),S(t,"add"),!1):c.test(a)?(n.textContent="",S(t,"remove"),!0):(n.textContent="Название может включать только буквы, пробелы и дефисы.",S(t,"add"),!1)),s=function(e){var t=e.input,n=e.errorElement;return t.checkValidity()?(n.textContent="",S(t,"remove"),!0):(n.textContent="Введите корректный URL.",S(t,"add"),!1)}(k);q(i&&s?"remove":"add")})),L.addEventListener("submit",(function(e){!function(e){var t;e.preventDefault(),t={name:L["place-name"].value,link:L.link.value},x.textContent="Сохранение...",function(e){return fetch("".concat(c.baseurl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify(e)}).then(i).catch((function(e){console.log(e)}))}(t).then((function(e){var t=l(e,Q,U);$.prepend(t),o(z),x.textContent="Сохранить"})),L.reset(),I("add")}(e)})),d.addEventListener("input",y),d.addEventListener("submit",(function(e){!function(e){var t;e.preventDefault(),y(),t={name:d.name.value,about:d.description.value},h.textContent="Сохранение...",function(e){return fetch("".concat(c.baseurl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify(e)}).then(i).catch((function(e){console.log(e)}))}(t).then((function(e){console.log("change profile ",e),u.textContent=e.name,m.textContent=e.about,h.textContent="Сорханить",o(H)}))}(e)})),w.addEventListener("input",O),w.addEventListener("submit",(function(e){!function(e){var t,n,r;e.preventDefault(),O(),t=w.link.value,(/\.(jpeg|jpg|gif|png)$/i.test(n=t)?fetch(n,{method:"HEAD",mode:"no-cors"}).then(i).then((function(e){return e.ok})).catch((function(e){console.log(e)})):(console.error("Неверный формат URL изображения"),0))?(B.textContent="Сохранение...",(r=t,fetch("".concat(c.baseurl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:r})}).then(i).catch((function(e){console.log(e)}))).then((function(e){j.src=e.avatar,o(M),B.textContent="Сохранить"}))):Promise.reject(new Error("некорректный url"))}(e)}))})();